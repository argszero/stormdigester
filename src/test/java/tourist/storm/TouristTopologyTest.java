package tourist.storm;

import backtype.storm.Config;
import backtype.storm.LocalCluster;
import backtype.storm.topology.TopologyBuilder;
import org.apache.mina.core.future.ConnectFuture;
import org.apache.mina.core.service.IoConnector;
import org.apache.mina.core.service.IoHandlerAdapter;
import org.apache.mina.core.session.IoSession;
import org.apache.mina.filter.codec.ProtocolCodecFilter;
import org.apache.mina.filter.codec.textline.TextLineCodecFactory;
import org.apache.mina.transport.socket.nio.NioSocketConnector;
import org.junit.After;
import org.junit.Before;
import org.junit.Test;

import java.net.InetSocketAddress;
import java.nio.charset.Charset;
import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.TimeZone;

/**
 * TouristTopology Tester.
 */
public class TouristTopologyTest {


    @Before
    public void before() throws Exception {
    }

    @After
    public void after() throws Exception {

    }

    /**
     * Method: main(String[] args)
     */
    @Test
    public void testMain() throws Exception {
        TopologyBuilder builder = TouristTopology.getTopologyBuilder();
        Config conf = new Config();
        conf.setDebug(true);

        LocalCluster cluster = new LocalCluster();
        cluster.submitTopology("tourist-count", conf, builder.createTopology());

        Thread.sleep(4 * 1000);
        Sender sender = new Sender(5001);
        sender.send("tourist 1", "2013-01-04 08:00:00", "", "tourist");

        sender.send("worker 1", "2013-01-04 08:00:00", "", "tourist");
        sender.send("worker 1", "2013-01-04 11:01:00", "", "out");

        sender.send("worker 1", "2013-01-05 08:00:00", "", "tourist");
        sender.send("worker 1", "2013-01-05 11:02:00", "", "out");


        sender.send("worker 1", "2013-01-06 08:00:00", "", "tourist");
        sender.send("worker 1", "2013-01-06 11:01:00", "", "out");

        sender.send("worker 1", "2013-01-07 08:00:00", "", "tourist");
        sender.send("worker 1", "2013-01-07 11:01:00", "", "out");

        sender.send("worker 1", "2013-01-08 08:00:00", "", "tourist");
        sender.send("worker 1", "2013-01-08 11:01:00", "", "out");

        sender.send("worker 1", "2013-01-09 08:00:00", "", "tourist");
        sender.send("worker 1", "2013-01-09 11:01:00", "", "out");


        Thread.sleep(1 * 1000);
        sender.close();
        Thread.sleep(1 * 1000);
        cluster.shutdown();
    }

    @Test
    public void testMain2() throws Exception {
        TopologyBuilder builder = TouristTopology.getTopologyBuilder();
        Config conf = new Config();
        conf.setDebug(true);

        LocalCluster cluster = new LocalCluster();
        cluster.submitTopology("tourist-count", conf, builder.createTopology());

        Thread.sleep(4 * 1000);
        Sender sender = new Sender(5001);
        sender.send("100001019584781", "2013-01-01 00:43:35", "chp", "tourist");
        sender.send("100001019584781", "2013-01-01 00:52:49", "xc", "tourist");

        Thread.sleep(1 * 1000);
        sender.close();
        Thread.sleep(1 * 1000);
        cluster.shutdown();
    }

    @Test
    public void testMain3() throws Exception {
        TopologyBuilder builder = TouristTopology.getTopologyBuilder();
        Config conf = new Config();
        conf.setDebug(true);

        LocalCluster cluster = new LocalCluster();
        cluster.submitTopology("tourist-count", conf, builder.createTopology());

        Thread.sleep(4 * 1000);
        Sender sender = new Sender(5001);
        String[] signals = new String[]{
                "100001000008822,1356999534990,chy,company,2013-01-01 00:18:54"
                ,"100001000008822,1357001142231,dc,company,2013-01-01 00:45:42"
                ,"100001000008822,1357002587255,dc,home,2013-01-01 01:09:47"
                ,"100001000008822,1357004517712,dc,stadium,2013-01-01 01:41:57"
                ,"100001000008822,1357007541503,hd,company,2013-01-01 02:32:21"
                ,"100001000008822,1357008398930,hd,mall,2013-01-01 02:46:38"
                ,"100001000008822,1357011683009,chp,company,2013-01-01 03:41:23"
                ,"100001000008822,1357012429131,shy,company,2013-01-01 03:53:49"
                ,"100001000008822,1357014498436,chp,home,2013-01-01 04:28:18"
                ,"100001000008822,1357015433919,shy,airport,2013-01-01 04:43:53"
                ,"100001000008822,1357018909544,shy,company,2013-01-01 05:41:49"
                ,"100001000008822,1357019100275,chp,mall,2013-01-01 05:45:00"
                ,"100001000008822,1357020024427,dc,airport,2013-01-01 06:00:24"
                ,"100001000008822,1357022779220,chy,home,2013-01-01 06:46:19"
                ,"100001000008822,1357024081355,xc,home,2013-01-01 07:08:01"
                ,"100001000008822,1357026561888,dc,airport,2013-01-01 07:49:21"
                ,"100001000008822,1357028252533,dc,tourist,2013-01-01 08:17:32"
                ,"100001000008822,1357029322387,chy,tourist,2013-01-01 08:35:22"
                ,"100001000008822,1357031723198,shy,tourist,2013-01-01 09:15:23"
                ,"100001000008822,1357032358673,chp,tourist,2013-01-01 09:25:58"
                ,"100001000008822,1357036878764,chy,tourist,2013-01-01 10:41:18"
                ,"100001000008822,1357037782230,chp,tourist,2013-01-01 10:56:22"
                ,"100001000008822,1357039624530,chy,tourist,2013-01-01 11:27:04"
                ,"100001000008822,1357041303395,chy,tourist,2013-01-01 11:55:03"
                ,"100001000008822,1357043073358,xc,tourist,2013-01-01 12:24:33"
                ,"100001000008822,1357044438787,shy,tourist,2013-01-01 12:47:18"
                ,"100001000008822,1357046120284,shy,tourist,2013-01-01 13:15:20"
                ,"100001000008822,1357046802827,hd,tourist,2013-01-01 13:26:42"
                ,"100001000008822,1357050676904,shy,tourist,2013-01-01 14:31:16"
                ,"100001000008822,1357051717025,chp,tourist,2013-01-01 14:48:37"
                ,"100001000008822,1357053920650,hd,tourist,2013-01-01 15:25:20"
                ,"100001000008822,1357055893833,xc,tourist,2013-01-01 15:58:13"
                ,"100001000008822,1357056600160,chp,tourist,2013-01-01 16:10:00"
                ,"100001000008822,1357058505253,dc,tourist,2013-01-01 16:41:45"
                ,"100001000008822,1357060085009,chy,tourist,2013-01-01 17:08:05"
                ,"100001000008822,1357062724030,dc,tourist,2013-01-01 17:52:04"
                ,"100001000008822,1357064727668,hd,tourist,2013-01-01 18:25:27"
                ,"100001000008822,1357065108702,dc,tourist,2013-01-01 18:31:48"
                ,"100001000008822,1357067542432,dc,tourist,2013-01-01 19:12:22"
                ,"100001000008822,1357070005434,chy,tourist,2013-01-01 19:53:25"
                ,"100001000008822,1357070688834,dc,tourist,2013-01-01 20:04:48"
                ,"100001000008822,1357072729106,dc,tourist,2013-01-01 20:38:49"
                ,"100001000008822,1357074135214,dc,tourist,2013-01-01 21:02:15"
                ,"100001000008822,1357077251317,shy,tourist,2013-01-01 21:54:11"
                ,"100001000008822,1357077626357,xc,tourist,2013-01-01 22:00:26"
                ,"100001000008822,1357077721714,shy,tourist,2013-01-01 22:02:01"
                ,"100001000008822,1357081649145,shy,tourist,2013-01-01 23:07:29"
                ,"100001000008822,1357084698832,xc,tourist,2013-01-01 23:58:18"
                ,"100001000008822,1357085107313,chy,tourist,2013-01-02 00:05:07"
                ,"100001000008822,1357087356496,xc,tourist,2013-01-02 00:42:36"
                ,"100001000008822,1357090016003,chp,tourist,2013-01-02 01:26:56"
                ,"100001000008822,1357091514851,xc,tourist,2013-01-02 01:51:54"
                ,"100001000008822,1357094732288,shy,tourist,2013-01-02 02:45:32"
                ,"100001000008822,1357095328220,chp,tourist,2013-01-02 02:55:28"
                ,"100001000008822,1357097465072,shy,tourist,2013-01-02 03:31:05"
                ,"100001000008822,1357098668125,dc,tourist,2013-01-02 03:51:08"
                ,"100001000008822,1357099742000,chp,tourist,2013-01-02 04:09:02"
                ,"100001000008822,1357101089254,shy,tourist,2013-01-02 04:31:29"
                ,"100001000008822,1357103123289,dc,tourist,2013-01-02 05:05:23"
                ,"100001000008822,1357104546229,xc,tourist,2013-01-02 05:29:06"
                ,"100001000008822,1357107891770,shy,tourist,2013-01-02 06:24:51"
                ,"100001000008822,1357109464409,dc,tourist,2013-01-02 06:51:04"
                ,"100001000008822,1357110044449,chy,tourist,2013-01-02 07:00:44"
                ,"100001000008822,1357110374300,chp,tourist,2013-01-02 07:06:14"
                ,"100001000008822,1357116805192,xc,home,2013-01-02 08:53:25"
                ,"100001000008822,1357116990753,hd,stadium,2013-01-02 08:56:30"
                ,"100001000008822,1357118691900,dc,home,2013-01-02 09:24:51"
                ,"100001000008822,1357119096123,chy,home,2013-01-02 09:31:36"
                ,"100001000008822,1357122021194,hd,airport,2013-01-02 10:20:21"
                ,"100001000008822,1357123279407,shy,airport,2013-01-02 10:41:19"
                ,"100001000008822,1357126034314,chp,airport,2013-01-02 11:27:14"
                ,"100001000008822,1357127763221,xc,airport,2013-01-02 11:56:03"
                ,"100001000008822,1357128822524,chp,home,2013-01-02 12:13:42"
                ,"100001000008822,1357130744609,xc,home,2013-01-02 12:45:44"
                ,"100001000008822,1357132421826,xc,home,2013-01-02 13:13:41"
                ,"100001000008822,1357135074089,shy,company,2013-01-02 13:57:54"
                ,"100001000008822,1357138499199,shy,home,2013-01-02 14:54:59"
                ,"100001000008822,1357138594312,xc,home,2013-01-02 14:56:34"
                ,"100001000008822,1357139768840,shy,company,2013-01-02 15:16:08"
                ,"100001000008822,1357140221850,hd,home,2013-01-02 15:23:41"
                ,"100001000008822,1357144956697,dc,stadium,2013-01-02 16:42:36"
                ,"100001000008822,1357145916618,shy,company,2013-01-02 16:58:36"
                ,"100001000008822,1357146322733,hd,airport,2013-01-02 17:05:22"
                ,"100001000008822,1357147896948,chp,mall,2013-01-02 17:31:36"
                ,"100001000008822,1357150233774,xc,mall,2013-01-02 18:10:33"
                ,"100001000008822,1357151944467,dc,stadium,2013-01-02 18:39:04"
                ,"100001000008822,1357154248125,chy,home,2013-01-02 19:17:28"
                ,"100001000008822,1357156660069,hd,mall,2013-01-02 19:57:40"
                ,"100001000008822,1357157781375,xc,company,2013-01-02 20:16:21"
                ,"100001000008822,1357158598582,shy,airport,2013-01-02 20:29:58"
                ,"100001000008822,1357160970589,hd,home,2013-01-02 21:09:30"
                ,"100001000008822,1357163533533,shy,stadium,2013-01-02 21:52:13"
                ,"100001000008822,1357164063056,chy,company,2013-01-02 22:01:03"
                ,"100001000008822,1357165094890,dc,home,2013-01-02 22:18:14"
                ,"100001000008822,1357168814703,dc,stadium,2013-01-02 23:20:14"
                ,"100001000008822,1357169633207,dc,mall,2013-01-02 23:33:53"
                ,"100001000008822,1357171567475,shy,company,2013-01-03 00:06:07"
                ,"100001000008822,1357173307622,xc,airport,2013-01-03 00:35:07"
                ,"100001000008822,1357176700267,chy,airport,2013-01-03 01:31:40"
                ,"100001000008822,1357177620314,xc,company,2013-01-03 01:47:00"
                ,"100001000008822,1357181022395,shy,airport,2013-01-03 02:43:42"
                ,"100001000008822,1357181700050,chp,company,2013-01-03 02:55:00"
                ,"100001000008822,1357182629214,chp,company,2013-01-03 03:10:29"
                ,"100001000008822,1357184849671,hd,company,2013-01-03 03:47:29"
                ,"100001000008822,1357185620413,shy,stadium,2013-01-03 04:00:20"
                ,"100001000008822,1357188059559,xc,mall,2013-01-03 04:40:59"
                ,"100001000008822,1357190031467,hd,company,2013-01-03 05:13:51"
                ,"100001000008822,1357192776786,chy,mall,2013-01-03 05:59:36"
                ,"100001000008822,1357193452099,chp,mall,2013-01-03 06:10:52"
                ,"100001000008822,1357193868067,hd,mall,2013-01-03 06:17:48"
                ,"100001000008822,1357197380057,chy,home,2013-01-03 07:16:20"
                ,"100001000008822,1357198703843,xc,mall,2013-01-03 07:38:23"
                ,"100001000008822,1357201698823,dc,tourist,2013-01-03 08:28:18"
                ,"100001000008822,1357203092142,chp,tourist,2013-01-03 08:51:32"
                ,"100001000008822,1357205057757,chp,tourist,2013-01-03 09:24:17"
                ,"100001000008822,1357205413930,xc,tourist,2013-01-03 09:30:13"
                ,"100001000008822,1357209252511,chy,tourist,2013-01-03 10:34:12"
                ,"100001000008822,1357209806168,chy,tourist,2013-01-03 10:43:26"
                ,"100001000008822,1357211488867,chp,tourist,2013-01-03 11:11:28"
                ,"100001000008822,1357214094679,chy,tourist,2013-01-03 11:54:54"
                ,"100001000008822,1357215389157,chp,tourist,2013-01-03 12:16:29"
                ,"100001000008822,1357217325585,shy,tourist,2013-01-03 12:48:45"
                ,"100001000008822,1357219323247,chp,tourist,2013-01-03 13:22:03"
                ,"100001000008822,1357220613381,shy,tourist,2013-01-03 13:43:33"
                ,"100001000008822,1357223272690,xc,tourist,2013-01-03 14:27:52"
                ,"100001000008822,1357224544786,shy,tourist,2013-01-03 14:49:04"
                ,"100001000008822,1357225396879,chp,tourist,2013-01-03 15:03:16"
                ,"100001000008822,1357227386502,xc,tourist,2013-01-03 15:36:26"
                ,"100001000008822,1357228821156,chp,tourist,2013-01-03 16:00:21"
                ,"100001000008822,1357232312443,chp,tourist,2013-01-03 16:58:32"
                ,"100001000008822,1357233156360,shy,tourist,2013-01-03 17:12:36"
                ,"100001000008822,1357235038524,shy,tourist,2013-01-03 17:43:58"
                ,"100001000008822,1357237452210,xc,tourist,2013-01-03 18:24:12"
                ,"100001000008822,1357238998310,shy,tourist,2013-01-03 18:49:58"
                ,"100001000008822,1357242342993,xc,tourist,2013-01-03 19:45:42"
                ,"100001000008822,1357242421729,chp,tourist,2013-01-03 19:47:01"
                ,"100001000008822,1357246058017,dc,tourist,2013-01-03 20:47:38"
                ,"100001000008822,1357246109394,shy,tourist,2013-01-03 20:48:29"
                ,"100001000008822,1357247705364,xc,tourist,2013-01-03 21:15:05"
                ,"100001000008822,1357247980556,shy,tourist,2013-01-03 21:19:40"
                ,"100001000008822,1357252054270,chy,tourist,2013-01-03 22:27:34"
                ,"100001000008822,1357252161358,dc,tourist,2013-01-03 22:29:21"
                ,"100001000008822,1357255915838,chy,tourist,2013-01-03 23:31:55"
                ,"100001000008822,1357256062179,chy,tourist,2013-01-03 23:34:22"
                ,"100001000008822,1357259647688,xc,tourist,2013-01-04 00:34:07"
                ,"100001000008822,1357259925048,xc,tourist,2013-01-04 00:38:45"
                ,"100001000008822,1357263949833,xc,tourist,2013-01-04 01:45:49"
                ,"100001000008822,1357263960086,chy,tourist,2013-01-04 01:46:00"
                ,"100001000008822,1357266970721,shy,tourist,2013-01-04 02:36:10"
                ,"100001000008822,1357267903718,hd,tourist,2013-01-04 02:51:43"
                ,"100001000008822,1357268478736,shy,tourist,2013-01-04 03:01:18"
                ,"100001000008822,1357271386254,xc,tourist,2013-01-04 03:49:46"
                ,"100001000008822,1357273009982,hd,tourist,2013-01-04 04:16:49"
                ,"100001000008822,1357274721637,shy,tourist,2013-01-04 04:45:21"
                ,"100001000008822,1357276888327,dc,tourist,2013-01-04 05:21:28"
                ,"100001000008822,1357277151292,chp,tourist,2013-01-04 05:25:51"
                ,"100001000008822,1357280589354,chy,tourist,2013-01-04 06:23:09"
                ,"100001000008822,1357281838735,chp,tourist,2013-01-04 06:43:58"
                ,"100001000008822,1357283018806,chp,tourist,2013-01-04 07:03:38"
                ,"100001000008822,1357283138012,dc,tourist,2013-01-04 07:05:38"
                ,"100001000008822,1357286561709,hd,tourist,2013-01-04 08:02:41"
                ,"100001000008822,1357287105364,xc,tourist,2013-01-04 08:11:45"
                ,"100001000008822,1357292384074,chp,tourist,2013-01-04 09:39:44"
                ,"100001000008822,1357292502319,dc,tourist,2013-01-04 09:41:42"
                ,"100001000008822,1357294485926,hd,tourist,2013-01-04 10:14:45"
                ,"100001000008822,1357294527610,xc,tourist,2013-01-04 10:15:27"
                ,"100001000008822,1357297442240,dc,tourist,2013-01-04 11:04:02"
                ,"100001000008822,1357300157904,dc,tourist,2013-01-04 11:49:17"
                ,"100001000008822,1357301939802,hd,tourist,2013-01-04 12:18:59"
                ,"100001000008822,1357303093430,dc,tourist,2013-01-04 12:38:13"
                ,"100001000008822,1357305229018,chy,tourist,2013-01-04 13:13:49"
                ,"100001000008822,1357305914818,hd,tourist,2013-01-04 13:25:14"
                ,"100001000008822,1357309411351,chy,tourist,2013-01-04 14:23:31"
                ,"100001000008822,1357310078060,dc,tourist,2013-01-04 14:34:38"
                ,"100001000008822,1357314574965,shy,tourist,2013-01-04 15:49:34"
                ,"100001000008822,1357314891491,chp,tourist,2013-01-04 15:54:51"
                ,"100001000008822,1357316499239,dc,tourist,2013-01-04 16:21:39"
                ,"100001000008822,1357316872036,hd,tourist,2013-01-04 16:27:52"
                ,"100001000008822,1357319213965,shy,tourist,2013-01-04 17:06:53"
                ,"100001000008822,1357322000230,dc,tourist,2013-01-04 17:53:20"
                ,"100001000008822,1357323488099,xc,tourist,2013-01-04 18:18:08"
                ,"100001000008822,1357323646230,dc,tourist,2013-01-04 18:20:46"
                ,"100001000008822,1357326269547,chp,tourist,2013-01-04 19:04:29"
                ,"100001000008822,1357328225516,shy,tourist,2013-01-04 19:37:05"
                ,"100001000008822,1357330157240,chp,tourist,2013-01-04 20:09:17"
                ,"100001000008822,1357332079433,shy,tourist,2013-01-04 20:41:19"
                ,"100001000008822,1357334984641,xc,tourist,2013-01-04 21:29:44"
                ,"100001000008822,1357336726509,xc,tourist,2013-01-04 21:58:46"
                ,"100001000008822,1357337293349,dc,tourist,2013-01-04 22:08:13"
                ,"100001000008822,1357339946109,xc,tourist,2013-01-04 22:52:26"
                ,"100001000008822,1357342119603,hd,tourist,2013-01-04 23:28:39"
                ,"100001000008822,1357342501106,chy,tourist,2013-01-04 23:35:01"
                ,"100001000008822,1357344345927,hd,tourist,2013-01-05 00:05:45"
                ,"100001000008822,1357347457281,chy,tourist,2013-01-05 00:57:37"
                ,"100001000008822,1357350227900,chp,tourist,2013-01-05 01:43:47"
                ,"100001000008822,1357350257329,shy,tourist,2013-01-05 01:44:17"
                ,"100001000008822,1357352065257,xc,tourist,2013-01-05 02:14:25"
                ,"100001000008822,1357354477892,xc,tourist,2013-01-05 02:54:37"
                ,"100001000008822,1357355172576,xc,tourist,2013-01-05 03:06:12"
                ,"100001000008822,1357356892582,hd,tourist,2013-01-05 03:34:52"
                ,"100001000008822,1357360177693,hd,tourist,2013-01-05 04:29:37"
                ,"100001000008822,1357360783077,dc,tourist,2013-01-05 04:39:43"
                ,"100001000008822,1357362440722,chp,tourist,2013-01-05 05:07:20"
                ,"100001000008822,1357365342504,xc,tourist,2013-01-05 05:55:42"
                ,"100001000008822,1357365630344,shy,tourist,2013-01-05 06:00:30"
                ,"100001000008822,1357368957769,shy,tourist,2013-01-05 06:55:57"
                ,"100001000008822,1357370404451,chp,tourist,2013-01-05 07:20:04"
                ,"100001000008822,1357371235334,chp,tourist,2013-01-05 07:33:55"
                ,"100001000008822,1357373668689,dc,mall,2013-01-05 08:14:28"
                ,"100001000008822,1357375076815,dc,stadium,2013-01-05 08:37:56"
                ,"100001000008822,1357376985515,xc,airport,2013-01-05 09:09:45"
                ,"100001000008822,1357377093471,dc,home,2013-01-05 09:11:33"
                ,"100001000008822,1357380816989,dc,company,2013-01-05 10:13:36"
                ,"100001000008822,1357380825848,chy,home,2013-01-05 10:13:45"
                ,"100001000008822,1357386398535,hd,home,2013-01-05 11:46:38"
                ,"100001000008822,1357387101605,xc,airport,2013-01-05 11:58:21"
                ,"100001000008822,1357387505916,shy,airport,2013-01-05 12:05:05"
                ,"100001000008822,1357389230303,hd,mall,2013-01-05 12:33:50"
                ,"100001000008822,1357393535750,dc,airport,2013-01-05 13:45:35"
                ,"100001000008822,1357393851322,chy,mall,2013-01-05 13:50:51"
                ,"100001000008822,1357395365648,xc,stadium,2013-01-05 14:16:05"
                ,"100001000008822,1357396267896,shy,mall,2013-01-05 14:31:07"
                ,"100001000008822,1357398393968,xc,mall,2013-01-05 15:06:33"
                ,"100001000008822,1357399259239,chp,company,2013-01-05 15:20:59"
                ,"100001000008822,1357403064853,hd,airport,2013-01-05 16:24:24"
                ,"100001000008822,1357404294182,dc,stadium,2013-01-05 16:44:54"
                ,"100001000008822,1357406360604,shy,company,2013-01-05 17:19:20"
                ,"100001000008822,1357407943949,dc,company,2013-01-05 17:45:43"
                ,"100001000008822,1357409650704,chp,airport,2013-01-05 18:14:10"
                ,"100001000008822,1357410017337,dc,mall,2013-01-05 18:20:17"
                ,"100001000008822,1357412704576,xc,home,2013-01-05 19:05:04"
                ,"100001000008822,1357415705180,dc,company,2013-01-05 19:55:05"
                ,"100001000008822,1357416822713,hd,company,2013-01-05 20:13:42"
                ,"100001000008822,1357418749020,dc,company,2013-01-05 20:45:49"
                ,"100001000008822,1357421165735,hd,stadium,2013-01-05 21:26:05"
                ,"100001000008822,1357421689562,dc,stadium,2013-01-05 21:34:49"
                ,"100001000008822,1357423664942,shy,stadium,2013-01-05 22:07:44"
                ,"100001000008822,1357424612945,chp,stadium,2013-01-05 22:23:32"
                ,"100001000008822,1357428759397,dc,airport,2013-01-05 23:32:39"
                ,"100001000008822,1357429858424,dc,mall,2013-01-05 23:50:58"
                ,"100001000008822,1357430609364,chy,mall,2013-01-06 00:03:29"
                ,"100001000008822,1357433601969,chy,stadium,2013-01-06 00:53:21"
                ,"100001000008822,1357434048992,hd,home,2013-01-06 01:00:48"
                ,"100001000008822,1357435621260,chy,company,2013-01-06 01:27:01"
                ,"100001000008822,1357441178590,hd,home,2013-01-06 02:59:38"
                ,"100001000008822,1357441188420,hd,airport,2013-01-06 02:59:48"
                ,"100001000008822,1357441987324,shy,stadium,2013-01-06 03:13:07"
                ,"100001000008822,1357444148073,shy,stadium,2013-01-06 03:49:08"
                ,"100001000008822,1357446572531,hd,stadium,2013-01-06 04:29:32"
                ,"100001000008822,1357448313605,hd,airport,2013-01-06 04:58:33"
                ,"100001000008822,1357449088012,shy,home,2013-01-06 05:11:28"
                ,"100001000008822,1357449489906,chp,home,2013-01-06 05:18:09"
                ,"100001000008822,1357452580668,xc,mall,2013-01-06 06:09:40"
                ,"100001000008822,1357455174900,shy,airport,2013-01-06 06:52:54"
                ,"100001000008822,1357456500160,shy,company,2013-01-06 07:15:00"
                ,"100001000008822,1357457655534,chp,company,2013-01-06 07:34:15"
                ,"100001000008822,1357462086244,dc,airport,2013-01-06 08:48:06"
                ,"100001000008822,1357462669760,chp,company,2013-01-06 08:57:49"
                ,"100001000008822,1357464662713,chp,stadium,2013-01-06 09:31:02"
                ,"100001000008822,1357465226747,chp,company,2013-01-06 09:40:26"
                ,"100001000008822,1357467421648,chy,airport,2013-01-06 10:17:01"
                ,"100001000008822,1357468806633,xc,home,2013-01-06 10:40:06"
                ,"100001000008822,1357470789921,shy,stadium,2013-01-06 11:13:09"
                ,"100001000008822,1357473091641,chy,company,2013-01-06 11:51:31"
                ,"100001000008822,1357476715639,chp,home,2013-01-06 12:51:55"
                ,"100001000008822,1357477159702,chp,stadium,2013-01-06 12:59:19"
                ,"100001000008822,1357477867380,hd,mall,2013-01-06 13:11:07"
                ,"100001000008822,1357480634629,shy,stadium,2013-01-06 13:57:14"
                ,"100001000008822,1357480819989,chp,stadium,2013-01-06 14:00:19"
                ,"100001000008822,1357483800000,shy,company,2013-01-06 14:50:00"
                ,"100001000008822,1357484875620,shy,mall,2013-01-06 15:07:55"
                ,"100001000008822,1357486818647,chp,mall,2013-01-06 15:40:18"
                ,"100001000008822,1357490575427,chp,mall,2013-01-06 16:42:55"
                ,"100001000008822,1357490990783,dc,company,2013-01-06 16:49:50"
                ,"100001000008822,1357493604053,shy,mall,2013-01-06 17:33:24"
                ,"100001000008822,1357494442573,hd,home,2013-01-06 17:47:22"
                ,"100001000008822,1357496150131,xc,company,2013-01-06 18:15:50"
                ,"100001000008822,1357497384502,chp,mall,2013-01-06 18:36:24"
                ,"100001000008822,1357500544488,shy,stadium,2013-01-06 19:29:04"
                ,"100001000008822,1357501154275,chp,airport,2013-01-06 19:39:14"
                ,"100001000008822,1357503063631,xc,airport,2013-01-06 20:11:03"
                ,"100001000008822,1357505795280,chy,home,2013-01-06 20:56:35"
                ,"100001000008822,1357506082005,chy,home,2013-01-06 21:01:22"
                ,"100001000008822,1357507784221,chp,company,2013-01-06 21:29:44"
                ,"100001000008822,1357511474528,xc,mall,2013-01-06 22:31:14"
                ,"100001000008822,1357512383365,chp,company,2013-01-06 22:46:23"
                ,"100001000008822,1357514832170,hd,airport,2013-01-06 23:27:12"
                ,"100001000008822,1357516150538,shy,company,2013-01-06 23:49:10"
                ,"100001000008822,1357520189695,dc,home,2013-01-07 00:56:29"
                ,"100001000008822,1357520308170,chp,stadium,2013-01-07 00:58:28"
                ,"100001000008822,1357521524609,xc,mall,2013-01-07 01:18:44"
                ,"100001000008822,1357523862165,hd,stadium,2013-01-07 01:57:42"
                ,"100001000008822,1357525433836,xc,home,2013-01-07 02:23:53"
                ,"100001000008822,1357527059804,chp,company,2013-01-07 02:50:59"
                ,"100001000008822,1357528888715,shy,home,2013-01-07 03:21:28"
                ,"100001000008822,1357529573694,xc,stadium,2013-01-07 03:32:53"
                ,"100001000008822,1357532514064,chy,mall,2013-01-07 04:21:54"
                ,"100001000008822,1357534306341,dc,home,2013-01-07 04:51:46"
                ,"100001000008822,1357537429522,shy,stadium,2013-01-07 05:43:49"
                ,"100001000008822,1357537511704,dc,company,2013-01-07 05:45:11"
                ,"100001000008822,1357540366674,shy,airport,2013-01-07 06:32:46"
                ,"100001000008822,1357541707336,shy,home,2013-01-07 06:55:07"
                ,"100001000008822,1357542529684,xc,stadium,2013-01-07 07:08:49"
                ,"100001000008822,1357543466103,chp,home,2013-01-07 07:24:26"
                ,"100001000008822,1357547208413,hd,airport,2013-01-07 08:26:48"
                ,"100001000008822,1357548121220,chy,stadium,2013-01-07 08:42:01"
                ,"100001000008822,1357551091114,xc,company,2013-01-07 09:31:31"
                ,"100001000008822,1357552086536,chp,mall,2013-01-07 09:48:06"
                ,"100001000008822,1357554049191,hd,home,2013-01-07 10:20:49"
                ,"100001000008822,1357556394378,chy,stadium,2013-01-07 10:59:54"
                ,"100001000008822,1357556842214,shy,stadium,2013-01-07 11:07:22"
                ,"100001000008822,1357557971646,chp,mall,2013-01-07 11:26:11"
                ,"100001000008822,1357562883393,hd,home,2013-01-07 12:48:03"
                ,"100001000008822,1357563272023,shy,home,2013-01-07 12:54:32"
                ,"100001000008822,1357564225907,shy,airport,2013-01-07 13:10:25"
                ,"100001000008822,1357567022640,hd,mall,2013-01-07 13:57:02"
                ,"100001000008822,1357567710559,chp,company,2013-01-07 14:08:30"
                ,"100001000008822,1357567915407,shy,mall,2013-01-07 14:11:55"
                ,"100001000008822,1357573044816,dc,airport,2013-01-07 15:37:24"
                ,"100001000008822,1357574188959,chy,mall,2013-01-07 15:56:28"
                ,"100001000008822,1357575657522,xc,mall,2013-01-07 16:20:57"
                ,"100001000008822,1357575845057,dc,home,2013-01-07 16:24:05"
                ,"100001000008822,1357578983518,chy,stadium,2013-01-07 17:16:23"
                ,"100001000008822,1357579033721,hd,home,2013-01-07 17:17:13"
                ,"100001000008822,1357582089462,shy,mall,2013-01-07 18:08:09"
                ,"100001000008822,1357584994293,dc,home,2013-01-07 18:56:34"
                ,"100001000008822,1357588060538,dc,company,2013-01-07 19:47:40"
                ,"100001000008822,1357588356940,hd,mall,2013-01-07 19:52:36"
                ,"100001000008822,1357590477454,chp,home,2013-01-07 20:27:57"
                ,"100001000008822,1357591049915,xc,stadium,2013-01-07 20:37:29"
                ,"100001000008822,1357594555211,hd,stadium,2013-01-07 21:35:55"
                ,"100001000008822,1357594956801,chy,home,2013-01-07 21:42:36"
                ,"100001000008822,1357596535702,chp,home,2013-01-07 22:08:55"
                ,"100001000008822,1357598970069,shy,company,2013-01-07 22:49:30"
                ,"100001000008822,1357602492632,hd,stadium,2013-01-07 23:48:12"
                ,"100001000008822,1357603170652,chp,home,2013-01-07 23:59:30"
                ,"100001000008822,1357605995128,xc,airport,2013-01-08 00:46:35"
                ,"100001000008822,1357606423926,shy,stadium,2013-01-08 00:53:43"
                ,"100001000008822,1357607931379,shy,stadium,2013-01-08 01:18:51"
                ,"100001000008822,1357608137035,dc,mall,2013-01-08 01:22:17"
                ,"100001000008822,1357611188872,dc,stadium,2013-01-08 02:13:08"
                ,"100001000008822,1357613271711,chy,airport,2013-01-08 02:47:51"
                ,"100001000008822,1357617188777,chy,home,2013-01-08 03:53:08"
                ,"100001000008822,1357617506343,chy,home,2013-01-08 03:58:26"
                ,"100001000008822,1357618699029,shy,stadium,2013-01-08 04:18:19"
                ,"100001000008822,1357621053526,chp,stadium,2013-01-08 04:57:33"
                ,"100001000008822,1357621903432,chp,company,2013-01-08 05:11:43"
                ,"100001000008822,1357623216991,chp,company,2013-01-08 05:33:36"
                ,"100001000008822,1357625092271,chp,stadium,2013-01-08 06:04:52"
                ,"100001000008822,1357626941564,chy,stadium,2013-01-08 06:35:41"
                ,"100001000008822,1357629121776,hd,company,2013-01-08 07:12:01"
                ,"100001000008822,1357631229919,chp,home,2013-01-08 07:47:09"
                ,"100001000008822,1357632708220,xc,tourist,2013-01-08 08:11:48"
                ,"100001000008822,1357633721801,dc,tourist,2013-01-08 08:28:41"
                ,"100001000008822,1357636009534,dc,tourist,2013-01-08 09:06:49"
                ,"100001000008822,1357638118289,dc,tourist,2013-01-08 09:41:58"
                ,"100001000008822,1357639422940,chp,tourist,2013-01-08 10:03:42"
                ,"100001000008822,1357639699008,dc,tourist,2013-01-08 10:08:19"
                ,"100001000008822,1357643826698,chy,tourist,2013-01-08 11:17:06"
                ,"100001000008822,1357645757594,hd,tourist,2013-01-08 11:49:17"
                ,"100001000008822,1357646663295,dc,tourist,2013-01-08 12:04:23"
                ,"100001000008822,1357647254246,chp,tourist,2013-01-08 12:14:14"
                ,"100001000008822,1357650133734,hd,tourist,2013-01-08 13:02:13"
                ,"100001000008822,1357653483916,hd,tourist,2013-01-08 13:58:03"
                ,"100001000008822,1357653777273,chp,tourist,2013-01-08 14:02:57"
                ,"100001000008822,1357656286278,chp,tourist,2013-01-08 14:44:46"
                ,"100001000008822,1357658084283,shy,tourist,2013-01-08 15:14:44"
                ,"100001000008822,1357659481151,shy,tourist,2013-01-08 15:38:01"
                ,"100001000008822,1357661597662,chy,tourist,2013-01-08 16:13:17"
                ,"100001000008822,1357662270378,chp,tourist,2013-01-08 16:24:30"
                ,"100001000008822,1357666567721,xc,tourist,2013-01-08 17:36:07"
                ,"100001000008822,1357667474980,xc,tourist,2013-01-08 17:51:14"
                ,"100001000008822,1357670180512,hd,tourist,2013-01-08 18:36:20"
                ,"100001000008822,1357670469328,chp,tourist,2013-01-08 18:41:09"
                ,"100001000008822,1357673337205,chp,tourist,2013-01-08 19:28:57"
                ,"100001000008822,1357673851977,chy,tourist,2013-01-08 19:37:31"
                ,"100001000008822,1357677630264,shy,tourist,2013-01-08 20:40:30"
                ,"100001000008822,1357678358677,dc,tourist,2013-01-08 20:52:38"
                ,"100001000008822,1357681218761,chy,tourist,2013-01-08 21:40:18"
                ,"100001000008822,1357682192719,dc,tourist,2013-01-08 21:56:32"
                ,"100001000008822,1357683007464,chp,tourist,2013-01-08 22:10:07"
                ,"100001000008822,1357684341444,chp,tourist,2013-01-08 22:32:21"
                ,"100001000008822,1357687847810,shy,tourist,2013-01-08 23:30:47"
                ,"100001000008822,1357688004370,dc,tourist,2013-01-08 23:33:24"
                ,"100001000008822,1357690621969,shy,tourist,2013-01-09 00:17:01"
                ,"100001000008822,1357692704922,hd,tourist,2013-01-09 00:51:44"
                ,"100001000008822,1357694450556,shy,tourist,2013-01-09 01:20:50"
                ,"100001000008822,1357694666123,chy,tourist,2013-01-09 01:24:26"
                ,"100001000008822,1357697724489,dc,tourist,2013-01-09 02:15:24"
                ,"100001000008822,1357700122688,shy,tourist,2013-01-09 02:55:22"
                ,"100001000008822,1357700646420,dc,tourist,2013-01-09 03:04:06"
                ,"100001000008822,1357703330121,hd,tourist,2013-01-09 03:48:50"
                ,"100001000008822,1357704834754,hd,tourist,2013-01-09 04:13:54"
                ,"100001000008822,1357705127862,chp,tourist,2013-01-09 04:18:47"
                ,"100001000008822,1357708325762,hd,tourist,2013-01-09 05:12:05"
                ,"100001000008822,1357709275462,shy,tourist,2013-01-09 05:27:55"
                ,"100001000008822,1357711386001,xc,tourist,2013-01-09 06:03:06"
                ,"100001000008822,1357713430056,xc,tourist,2013-01-09 06:37:10"
                ,"100001000008822,1357714984269,shy,tourist,2013-01-09 07:03:04"
                ,"100001000008822,1357718235754,chp,tourist,2013-01-09 07:57:15"
                ,"100001000008822,1357720398089,dc,tourist,2013-01-09 08:33:18"
                ,"100001000008822,1357720833627,chy,tourist,2013-01-09 08:40:33"
                ,"100001000008822,1357722443553,shy,tourist,2013-01-09 09:07:23"
                ,"100001000008822,1357722605160,dc,tourist,2013-01-09 09:10:05"
                ,"100001000008822,1357725687420,dc,tourist,2013-01-09 10:01:27"
                ,"100001000008822,1357726318990,chp,tourist,2013-01-09 10:11:58"
                ,"100001000008822,1357730395473,shy,tourist,2013-01-09 11:19:55"
                ,"100001000008822,1357732090925,chy,tourist,2013-01-09 11:48:10"
                ,"100001000008822,1357733736079,hd,tourist,2013-01-09 12:15:36"
                ,"100001000008822,1357734608877,hd,tourist,2013-01-09 12:30:08"
                ,"100001000008822,1357736693057,xc,tourist,2013-01-09 13:04:53"
                ,"100001000008822,1357738453550,shy,tourist,2013-01-09 13:34:13"
                ,"100001000008822,1357743281603,hd,tourist,2013-01-09 14:54:41"
                ,"100001000008822,1357743535653,hd,tourist,2013-01-09 14:58:55"
                ,"100001000008822,1357746334694,hd,tourist,2013-01-09 15:45:34"
                ,"100001000008822,1357746543197,dc,tourist,2013-01-09 15:49:03"
                ,"100001000008822,1357748836821,xc,tourist,2013-01-09 16:27:16"
                ,"100001000008822,1357750472531,chp,tourist,2013-01-09 16:54:32"
                ,"100001000008822,1357751403315,dc,tourist,2013-01-09 17:10:03"
                ,"100001000008822,1357751754604,shy,tourist,2013-01-09 17:15:54"
                ,"100001000008822,1357756692763,hd,tourist,2013-01-09 18:38:12"
                ,"100001000008822,1357757284286,chy,tourist,2013-01-09 18:48:04"
                ,"100001000008822,1357760940724,xc,tourist,2013-01-09 19:49:00"
                ,"100001000008822,1357761051943,xc,tourist,2013-01-09 19:50:51"
                ,"100001000008822,1357763783205,chy,tourist,2013-01-09 20:36:23"
                ,"100001000008822,1357764377352,xc,tourist,2013-01-09 20:46:17"
                ,"100001000008822,1357766930004,dc,tourist,2013-01-09 21:28:50"
                ,"100001000008822,1357767769189,shy,tourist,2013-01-09 21:42:49"
                ,"100001000008822,1357770054138,dc,tourist,2013-01-09 22:20:54"
                ,"100001000008822,1357771510150,xc,tourist,2013-01-09 22:45:10"
                ,"100001000008822,1357773164705,hd,tourist,2013-01-09 23:12:44"
                ,"100001000008822,1357774593586,hd,tourist,2013-01-09 23:36:33"
                ,"100001000008822,1357776241138,chy,tourist,2013-01-10 00:04:01"
                ,"100001000008822,1357777433785,shy,tourist,2013-01-10 00:23:53"
                ,"100001000008822,1357779664046,chy,tourist,2013-01-10 01:01:04"
                ,"100001000008822,1357780057769,dc,tourist,2013-01-10 01:07:37"
                ,"100001000008822,1357785513332,shy,tourist,2013-01-10 02:38:33"
                ,"100001000008822,1357786258856,chy,tourist,2013-01-10 02:50:58"
                ,"100001000008822,1357787639819,hd,tourist,2013-01-10 03:13:59"
                ,"100001000008822,1357789688810,shy,tourist,2013-01-10 03:48:08"
                ,"100001000008822,1357792527822,chp,tourist,2013-01-10 04:35:27"
                ,"100001000008822,1357793506514,hd,tourist,2013-01-10 04:51:46"
                ,"100001000008822,1357795531947,chp,tourist,2013-01-10 05:25:31"
                ,"100001000008822,1357797063400,chy,tourist,2013-01-10 05:51:03"
                ,"100001000008822,1357798545028,xc,tourist,2013-01-10 06:15:45"
                ,"100001000008822,1357799123329,shy,tourist,2013-01-10 06:25:23"
                ,"100001000008822,1357802227599,dc,tourist,2013-01-10 07:17:07"
                ,"100001000008822,1357803851447,chp,tourist,2013-01-10 07:44:11"
                ,"100001000008822,1357807043425,hd,company,2013-01-10 08:37:23"
                ,"100001000008822,1357807852034,chy,stadium,2013-01-10 08:50:52"
                ,"100001000008822,1357809397982,hd,stadium,2013-01-10 09:16:37"
                ,"100001000008822,1357811094560,xc,home,2013-01-10 09:44:54"
                ,"100001000008822,1357814766194,dc,airport,2013-01-10 10:46:06"
                ,"100001000008822,1357815527235,chp,company,2013-01-10 10:58:47"
                ,"100001000008822,1357817145351,chp,company,2013-01-10 11:25:45"
                ,"100001000008822,1357817273600,xc,stadium,2013-01-10 11:27:53"
                ,"100001000008822,1357822425399,chp,company,2013-01-10 12:53:45"
                ,"100001000008822,1357822652147,hd,home,2013-01-10 12:57:32"
                ,"100001000008822,1357822962133,chp,stadium,2013-01-10 13:02:42"
                ,"100001000008822,1357823886293,hd,stadium,2013-01-10 13:18:06"
                ,"100001000008822,1357826469614,shy,stadium,2013-01-10 14:01:09"
                ,"100001000008822,1357829061840,dc,stadium,2013-01-10 14:44:21"
                ,"100001000008822,1357832631708,chp,stadium,2013-01-10 15:43:51"
                ,"100001000008822,1357833419545,chp,company,2013-01-10 15:56:59"
                ,"100001000008822,1357835041215,chy,company,2013-01-10 16:24:01"
                ,"100001000008822,1357835527750,chp,company,2013-01-10 16:32:07"
                ,"100001000008822,1357838501995,chy,stadium,2013-01-10 17:21:41"
                ,"100001000008822,1357839525047,hd,airport,2013-01-10 17:38:45"
                ,"100001000008822,1357841055261,chy,airport,2013-01-10 18:04:15"
                ,"100001000008822,1357842851503,chy,home,2013-01-10 18:34:11"
                ,"100001000008822,1357844995776,shy,airport,2013-01-10 19:09:55"
                ,"100001000008822,1357845719244,dc,stadium,2013-01-10 19:21:59"
                ,"100001000008822,1357850528067,hd,stadium,2013-01-10 20:42:08"
                ,"100001000008822,1357851346718,xc,company,2013-01-10 20:55:46"
                ,"100001000008822,1357853294313,shy,stadium,2013-01-10 21:28:14"
                ,"100001000008822,1357854850563,xc,airport,2013-01-10 21:54:10"
                ,"100001000008822,1357855312792,xc,stadium,2013-01-10 22:01:52"
                ,"100001000008822,1357857687061,chy,home,2013-01-10 22:41:27"
                ,"100001000008822,1357861376354,chp,stadium,2013-01-10 23:42:56"
                ,"100001000008822,1357862046496,dc,mall,2013-01-10 23:54:06"
        };
        for (int i = 0; i < signals.length; i++) {
            String signal = signals[i];
            signal = signal.substring(0, signal.lastIndexOf(","));
//            System.out.println(signal);
            sender.send(signal);
        }
        sender.close();
        cluster.shutdown();
    }

    private static class Sender extends IoHandlerAdapter {
        private final IoConnector connector;
        private final IoSession session;

        private Sender(int port) {
            connector = new NioSocketConnector();
            connector.setHandler(this);
            connector.getFilterChain().addLast("codec", new ProtocolCodecFilter(new TextLineCodecFactory(Charset.forName("UTF-8"))));
            ConnectFuture future = connector.connect(new InetSocketAddress(port));
            future.awaitUninterruptibly();
            session = future.getSession();
        }

        @Override
        public void messageReceived(IoSession session, Object message) throws Exception {
            super.messageReceived(session, message);    //To change body of overridden methods use File | Settings | File Templates.
        }

        public void send(String imsi, String time, String loc, String cell) throws ParseException {
            StringBuilder sb = new StringBuilder();
            session.write(sb.append(imsi).append(",").append(getTime(time)).append(",").append(loc).append(",").append(cell));
        }

        public void send(String imsi, long time, String loc, String cell) throws ParseException {
            StringBuilder sb = new StringBuilder();
            session.write(sb.append(imsi).append(",").append(time).append(",").append(loc).append(",").append(cell));
        }

        public void send(String signal) throws ParseException {
            session.write(signal);
        }

        public void close() throws InterruptedException {
            session.close(false).await();
            connector.dispose();
        }
    }

    private static long getTime(String s) throws ParseException {
        return new SimpleDateFormat("yyyy-MM-dd HH:mm:ss Z").parse(s + " +0000").getTime();
    }

    private static String getTime(long s) throws ParseException {
        return new SimpleDateFormat("yyyy-MM-dd HH:mm:ss").format(new Date(s - TimeZone.getDefault().getRawOffset()));
    }

    public static void main(String[] args) throws ParseException {
        System.out.println(getTime(1357001015454L));
        System.out.println(getTime(1357001569894L));
    }
}
